## 자동 북노트 메이커

---
Created: 2024-09-04 13:11
tags:
  - 🌶️
분류:
  - "[[데이터뷰]]"
  - "[[서버 관리]]"
  - "[[소설]]"
  - "[[워크플로우 자동화]]"
---

### 체크리스트
- [x] [[Calibre Server]]에서 자체지원하는 calibredb - cli 명령어를 통해 db내의 모든 도서 정보를 긁어옴
- [x] [[책 - 관심|책 템플릿]]에 걸맞는 형식으로 긁어온 정보를 [[마크다운]] 문서화
- [x] 하는 동시에 각 노트의 필수 정보 (id, title, 문서내용기반md5) 를 binary 파일로 저장
- [x] 생성된 문서는 [[OneDrive for Linux]]를 통해 업로드
- [x] 문서의 modified 여부를 감시하기 위해 계속 md5 체크
- [x] 수정된 내용을 서버에 반영하기 위해 마크다운을 해석
- [x] 해석된 내용을 cli로 입력
- [x] [[Calibre]]가 자체지원하는 `calibre://` 형식 링크와 `[[]]` 상호변환, 내용에 따라 링크 자동 생성
- [x] shortenline 함수가 3줄을 2줄로, 2줄을 1줄로 바꾸다보니 더블엔터가 싹 사라져버림;; 그거 수정해야됨


### 업데이트 내역
- [[2024-09-05]] : v1.0
- [[2024-09-10]] : v1.1
- [[2024-10-20]] : v2.0
- [[2024-10-31]] : v2.1 - 스크립트에 대대적인 수정

### 개요
- db파일과 원드라이브 디렉토리를 상시 감시하는 서비스 가동중
- 특정 이벤트가 발생하면 바로 인식하고 해당 exec파일 실행
- 생성된 책 노트들은 dataview로 자동 목록화
- 한글과 이모지, 유니코드의 능수능란하고 오류없는 지원을 위해 rune 도입
- 책, 작가 이름을 인식해 자동으로 calibre 타입 uri 생성

### 설명서
#### 책 상태 - $status
- "안읽음" = "📘" `:blue_book`
- "읽는중" = "📖" `:book`
- "읽음" = "📗" `:green_book`
- "읽다맘" = "📕" `:closed_book`
- "대기중" = "🔖" `:bookmark`

### 알고리즘 재생성
1. ob에서 문서를 수정
	1. md5 확인 방식으로 수정된 문서 체크
	2. 
2. ob에서 문서 삭제
	1. 이것도 체크할 일 없음
3. ca에서 문서 수정
	1. 어차피 체크할 일 없을 듯
4. ca에서 문서 삭제
	1. ca에서 빠진 id 확인
	2. 해당 id에 해당하는 title 체크
	3. title file delete
	4. binary 에서 제거
5. ca에서 문서 추가
	1. ca에서 추가된 문서 id 겟
	2. 해당 id로 show metadata
	3. 얻어진 md -> 문서화
	4. 바이너리 추가